<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plantilla - Bar√ßa Athletic Hub</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #1a237e;
            --secondary-color: #283593;
            --accent-color: #ffd700;
            --text-light: #e3e3e3;
        }

        body {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: #fff;
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Navbar */
        .navbar {
            background: rgba(0, 0, 0, 0.3) !important;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
            color: var(--accent-color) !important;
            transition: transform 0.3s ease;
        }

        .navbar-brand:hover {
            transform: scale(1.05);
        }

        .nav-link {
            color: #fff !important;
            margin: 0 10px;
            position: relative;
            transition: color 0.3s ease;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--accent-color);
            transition: width 0.3s ease;
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .nav-link.admin-link {
            color: #dc3545 !important;
            font-weight: 600;
        }

        /* Container */
        .container {
            padding-top: 120px;
            padding-bottom: 60px;
        }

        h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* Stats Cards */
        .stat {
            background: linear-gradient(145deg, rgba(255,255,255,0.95), rgba(255,255,255,0.9));
            color: var(--secondary-color);
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 25px;
            transition: all 0.3s ease;
        }

        .stat:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .stat h3 {
            font-size: 2.5rem;
            font-weight: 800;
            margin: 0;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .stat p {
            margin: 10px 0 0 0;
            color: #666;
            font-size: 1.1rem;
            font-weight: 600;
        }

        /* Footer */
        footer {
            text-align: center;
            padding: 30px 0;
            background: rgba(0, 0, 0, 0.4);
            color: var(--text-light);
            margin-top: 60px;
            backdrop-filter: blur(10px);
        }

        footer p {
            margin: 0;
            font-size: 0.95rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding-top: 100px;
            }

            h1 {
                font-size: 2.2rem;
            }

            .stat h3 {
                font-size: 2rem;
            }
        }

        /* Cards de jugadores */

        .players-section-title {
            font-size: 2rem;
            font-weight: 700;
            margin: 40px 0 20px;
        }

        .player-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.95), rgba(255,255,255,0.9));
            color: var(--secondary-color);
            border-radius: 18px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
            transition: all 0.3s ease;
            height: 100%;
            margin: 0 auto;
            max-width: 340px;          /* evita que se estiren demasiado */
        }

        .player-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.3);
        }

        .player-card img {
            width: 100%;
            height: 220px;
            object-fit: cover;
        }

        .player-card-body {
            padding: 15px 18px 20px;
        }

        .player-card-body h5 {
            font-weight: 800;
            margin-bottom: 8px;
        }

        .player-meta {
            font-size: 0.95rem;
            margin-bottom: 4px;
        }

        .player-badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 999px;
            font-size: 0.75rem;
            font-weight: 700;
            letter-spacing: 0.03em;
            margin-bottom: 8px;
        }

        /* Colores por posici√≥n */
        .player-badge.pos-portero {
            background: #ffd54f;
            color: #333;
        }

        .player-badge.pos-defensa {
            background: #42a5f5;
            color: #fff;
        }

        .player-badge.pos-centrocampista {
            background: #66bb6a;
            color: #fff;
        }

        .player-badge.pos-delantero {
            background: #ef5350;
            color: #fff;
        }

        .team-banner {
            max-width: 900px;
            margin: 40px auto 10px;
            padding: 20px 28px;
            border-radius: 24px;
            background: rgba(0, 0, 0, 0.25);
            box-shadow: 0 15px 40px rgba(0,0,0,0.35);
        }

        .team-banner-content {
            display: flex;
            align-items: center;
            gap: 24px;
        }

        .team-banner-logo {
            width: 110px;
            height: auto;
            flex-shrink: 0;
            border-radius: 18px;
        }

        .team-banner-title {
            font-size: 2.3rem;
            font-weight: 800;
        }

        .team-banner-subtitle {
            font-size: 0.95rem;
            opacity: 0.9;
        }

        /* Opcional: en m√≥viles, que se ponga en columna */
        @media (max-width: 576px) {
            .team-banner-content {
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .team-banner-logo {
                width: 90px;
            }
        }

        .players-filter {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        .filter-chip {
            display: inline-block;
            padding: 6px 16px;
            border-radius: 999px;
            border: 1px solid rgba(255,255,255,0.35);
            background: rgba(255,255,255,0.08);
            color: #fff;
            font-size: 0.85rem;
            font-weight: 700;
            letter-spacing: 0.04em;
            text-transform: uppercase;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .filter-chip:hover {
            background: rgba(255,255,255,0.2);
        }

        .filter-chip.active {
            background: #ffd700;
            color: #1a237e;
            border-color: #ffd700;
        }

        /* Tarjeta Pr√≥ximo partido */

        .next-match-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.97), rgba(255,255,255,0.93));
            color: var(--secondary-color);
            border-radius: 24px;
            padding: 20px 28px;
            box-shadow: 0 12px 32px rgba(0,0,0,0.25);
        }

        .next-match-label {
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            font-weight: 700;
            color: #888;
        }

        .next-match-header {
            text-align: center;
            margin-top: 4px;
        }

        .next-match-stadium {
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: #888;
        }

        .next-match-date {
            font-size: 1rem;
            font-weight: 600;
            color: #333;
        }

        /* Layout de los equipos: 3 columnas */
        .next-match-layout {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            gap: 16px;
            margin-top: 16px;
        }

        .match-team {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .match-team-logo {
            width: 70px;
            height: auto;
        }

        .match-team-name {
            margin-top: 6px;
            font-weight: 800;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            font-size: 0.95rem;
            text-align: center;
        }

        .vs-text {
            font-weight: 900;
            font-size: 1.2rem;
            letter-spacing: 0.15em;
            text-align: center;
        }

        .next-match-btn {
            font-weight: 700;
            border-radius: 999px;
            padding: 8px 24px;
            background-color: var(--accent-color);
            color: #1a237e;
            border: none;
            box-shadow: 0 6px 16px rgba(0,0,0,0.25);
        }

        .next-match-btn:hover {
            background-color: #ffe066;
            color: #1a237e;
        }

        /* Responsive para la tarjeta de pr√≥ximo partido */
        @media (max-width: 576px) {
            .next-match-layout {
                grid-template-columns: 1fr;
                row-gap: 10px;
            }

            .vs-text {
                order: 2;
            }
        }

        /* Chatbot flotante */
        .chatbot-float-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 65px;
            height: 65px;
            border-radius: 50%;
            background: linear-gradient(135deg, #004D98, #A50044);
            color: white;
            border: none;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
            cursor: pointer;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            transition: all 0.3s ease;
            animation: pulse 2s infinite;
        }

        .chatbot-float-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 25px rgba(0, 77, 152, 0.6);
        }

        @keyframes pulse {
            0%, 100% {
                box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
            }
            50% {
                box-shadow: 0 6px 30px rgba(165, 0, 68, 0.6);
            }
        }

        .chatbot-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            border: 2px solid white;
        }

        /* Modal del chatbot */
        .chatbot-modal {
            display: none;
            position: fixed;
            bottom: 110px;
            right: 30px;
            width: 400px;
            max-height: 600px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            flex-direction: column;
            overflow: hidden;
        }

        .chatbot-modal.active {
            display: flex;
        }

        .chatbot-modal-header {
            background: linear-gradient(90deg, #004D98, #A50044);
            color: white;
            padding: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-modal-header h3 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 700;
        }

        .chatbot-close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background 0.2s;
        }

        .chatbot-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .chatbot-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f8f9fa;
            max-height: 400px;
        }

        .chatbot-message {
            display: flex;
            margin-bottom: 12px;
            animation: fadeInMsg 0.3s ease-in;
        }

        @keyframes fadeInMsg {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chatbot-message.user {
            justify-content: flex-end;
        }

        .chatbot-message.bot {
            justify-content: flex-start;
        }

        .chatbot-bubble {
            max-width: 75%;
            padding: 10px 14px;
            border-radius: 15px;
            word-wrap: break-word;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .chatbot-message.user .chatbot-bubble {
            background: linear-gradient(135deg, #004D98, #0066CC);
            color: white;
            border-bottom-right-radius: 4px;
        }

        .chatbot-message.bot .chatbot-bubble {
            background: white;
            color: #333;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 4px;
        }

        .chatbot-bubble strong {
            font-weight: 700;
            color: #004D98;
        }

        .chatbot-message.user .chatbot-bubble strong {
            color: #FFD700;
        }

        .chatbot-video-container {
            margin-top: 10px;
            border-radius: 8px;
            overflow: hidden;
            max-width: 100%;
            background: #000;
            position: relative;
            padding-bottom: 56.25%; /* Aspect ratio 16:9 */
            height: 0;
        }

        .chatbot-video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .chatbot-input-area {
            padding: 15px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 8px;
        }

        .chatbot-input {
            flex: 1;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 20px;
            outline: none;
            font-size: 0.9rem;
        }

        .chatbot-input:focus {
            border-color: #004D98;
        }

        .chatbot-send-btn {
            padding: 10px 20px;
            background: linear-gradient(135deg, #004D98, #0066CC);
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .chatbot-send-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 77, 152, 0.4);
        }

        .chatbot-send-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .chatbot-typing {
            display: none;
            padding: 8px 12px;
            background: white;
            border-radius: 15px;
            width: fit-content;
            border: 1px solid #e0e0e0;
        }

        .chatbot-typing span {
            height: 8px;
            width: 8px;
            background: #004D98;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }

        .chatbot-typing span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .chatbot-typing span:nth-child(3) {
            animation-delay: 0.4s;
        }

        /* Botones de opciones interactivas */
        .chatbot-options {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 12px;
        }

        .chatbot-option-btn {
            background: linear-gradient(135deg, #f0f0f0, #ffffff);
            border: 2px solid #004D98;
            color: #004D98;
            padding: 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-align: left;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .chatbot-option-btn:hover {
            background: linear-gradient(135deg, #004D98, #0066CC);
            color: white;
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0, 77, 152, 0.3);
        }

        .chatbot-option-btn:active {
            transform: translateX(3px) scale(0.98);
        }

        .chatbot-option-btn i {
            font-size: 1.1rem;
        }

        .chatbot-option-btn.selected {
            background: linear-gradient(135deg, #004D98, #0066CC);
            color: white;
            cursor: default;
        }

        .chatbot-option-btn.selected:hover {
            transform: none;
        }

        /* Bot√≥n Volver */
        .chatbot-back-btn {
            background: linear-gradient(135deg, #e0e0e0, #f5f5f5);
            border: 2px solid #666;
            color: #333;
            padding: 10px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            text-align: center;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-top: 15px;
        }

        .chatbot-back-btn:hover {
            background: linear-gradient(135deg, #666, #888);
            color: white;
            transform: translateX(-5px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .chatbot-back-btn i {
            font-size: 0.9rem;
        }

        /* Mensaje de error/advertencia */
        .chatbot-warning {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            color: #856404;
        }

        .chatbot-error {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            color: #721c24;
        }

        @media (max-width: 576px) {
            .chatbot-modal {
                width: calc(100vw - 20px);
                right: 10px;
                bottom: 100px;
            }

            .chatbot-float-btn {
                right: 20px;
                bottom: 20px;
            }
        }

    </style>
</head>
<body>

<nav class="navbar navbar-expand-lg navbar-dark fixed-top">
    <div class="container-fluid">
        <a class="navbar-brand" href="/">
            <img src="/logo.jpg" alt="Bar√ßa Atl√®tic" style="height: 30px; margin-right: 8px;"> Bar√ßa Atl√®tic
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="/"><i class="fas fa-home"></i> Inicio</a></li>
                <li class="nav-item"><a class="nav-link" href="/plantilla"><i class="fas fa-users"></i> Plantilla</a></li>
                <li class="nav-item"><a class="nav-link" href="/eventos"><i class="fas fa-calendar-alt"></i> Eventos</a></li>
                <li class="nav-item"><a class="nav-link" href="/noticias"><i class="fas fa-newspaper"></i> Noticias</a></li>
                <!-- Opciones solo para usuarios normales (no admin) -->
                <li class="nav-item" th:if="${logueado == true && esAdmin == false}"><a class="nav-link" href="/tickets"><i class="fas fa-ticket-alt"></i> Tickets</a></li>
                <li class="nav-item" th:if="${logueado == true && esAdmin == false}"><a class="nav-link" href="/recordatorios"><i class="fas fa-bell"></i> Recordatorios</a></li>
                <!-- Opciones solo para admin -->
                <li class="nav-item" th:if="${esAdmin == true}"><a class="nav-link admin-link" href="/admin/eventos"><i class="fas fa-tools"></i> Panel Admin</a></li>
                <li class="nav-item" th:if="${esAdmin == true}"><a class="nav-link admin-link" href="/admin/usuarios"><i class="fas fa-users-cog"></i> Admin Usuarios</a></li>
                <!-- Opciones para no logueados -->
                <li class="nav-item" th:if="${logueado != true}"><a class="nav-link" href="/login"><i class="fas fa-sign-in-alt"></i> Iniciar Sesi√≥n</a></li>
                <li class="nav-item" th:if="${logueado != true}"><a class="nav-link" href="/registro"><i class="fas fa-user-plus"></i> Registro</a></li>
                <!-- Cerrar sesi√≥n para todos los logueados -->
                <li class="nav-item" th:if="${logueado == true}"><a class="nav-link" href="/logout"><i class="fas fa-sign-out-alt"></i> Cerrar Sesi√≥n</a></li>
            </ul>
        </div>
    </div>
</nav>

<div class="container">
    <h1>
        <i class="fas fa-users"></i>
        <span th:text="${mensaje}">Plantilla del Bar√ßa Atl√®tic</span>
    </h1>

    <div class="row">
        <div class="col-md-4">
            <div class="stat">
                <h3><i class="fas fa-users me-3"></i>25</h3>
                <p>Jugadores en Plantilla</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat">
                <h3><i class="fas fa-trophy me-3"></i>12</h3>
                <p>Victorias esta Temporada</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat">
                <h3><i class="fas fa-futbol me-3"></i>45</h3>
                <p>Goles Anotados</p>
            </div>
        </div>
    </div>

    <!-- Segunda fila de m√©tricas -->
    <div class="row mt-3">
        <div class="col-md-4">
            <div class="stat">
                <h3>4.¬∫</h3>
                <p>Posici√≥n en la tabla</p>
            </div>
        </div>

        <div class="col-md-4">
            <div class="stat">
                <h3>21,4</h3>
                <p>Edad media de la plantilla (a√±os)</p>
            </div>
        </div>

        <div class="col-md-4">
            <div class="stat">
                <h3>18 / 7</h3>
                <p>Sub-23 / Jugadores extranjeros</p>
            </div>
        </div>
    </div>

    <div class="row mt-4">
        <div class="col-12">
            <div class="stat">
                <h3 style="font-size: 1.5rem;"><i class="fas fa-info-circle me-3"></i>Informaci√≥n</h3>
                <p style="margin-top: 15px; line-height: 1.8;">
                    El Bar√ßa Atl√®tic es el equipo filial del FC Barcelona que compite en la Primera Divisi√≥n RFEF.
                    Aqu√≠ se forman las futuras estrellas del primer equipo con jugadores j√≥venes de gran talento.
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Tarjeta Pr√≥ximo partido -->
<div class="row mt-4" th:if="${proximoEvento != null}">
    <div class="col-12 col-lg-10 mx-auto">
        <div class="next-match-card">

            <p class="next-match-label mb-1">Pr√≥ximo partido</p>

            <!-- Cabecera centrada -->
            <div class="next-match-header mb-3">
                <p class="next-match-stadium mb-1"
                   th:text="${proximoEvento.lugar}">
                    ESTADI JOHAN CRUYFF
                </p>

                <p class="next-match-date mb-0"
                   th:text="${#temporals.format(proximoEvento.fecha, 'dd MMM yyyy ¬∑ HH:mm')}">
                    24 dic 2025 ¬∑ 19:00
                </p>
            </div>

            <!-- Layout Bar√ßa | VS | Rival -->
            <div class="next-match-layout">

                <!-- Bar√ßa Atl√®tic -->
                <div class="match-team">
                    <img src="/img/escudos/BARCA.png"
                         alt="Escudo Bar√ßa Atl√®tic"
                         class="match-team-logo">
                    <span class="match-team-name">BAR√áA ATL√àTIC</span>
                </div>

                <!-- VS -->
                <div class="vs-text">VS</div>

                <!-- Rival (puedes cambiar el texto por algo din√°mico si quieres m√°s adelante) -->
                <div class="match-team">
                    <img src="/img/escudos/REAL.png"
                         alt="Escudo equipo rival"
                         class="match-team-logo">
                    <span class="match-team-name">REAL MADRID CASTILLA</span>
                </div>

            </div>

            <!-- Bot√≥n -->
            <div class="text-center mt-3">
                <a href="/eventos" class="btn next-match-btn">
                    Ver todos los eventos
                </a>
            </div>

        </div>
    </div>
</div>

<div class="team-banner mt-5">
    <div class="team-banner-content">
        <img src="/img/logo/logo.png"
             alt="Escudo FC Barcelona"
             class="team-banner-logo">

        <div class="team-banner-text">
            <h2 class="team-banner-title mb-1">Bar√ßa Atl√®tic</h2>
            <p class="team-banner-subtitle mb-0">
                Equipo filial del FC Barcelona ¬∑ Primera Federaci√≥n
            </p>
        </div>
    </div>
</div>

<!-- ==========================
     SECCI√ìN JUGADORES
========================== -->
<div class="row mt-5 justify-content-center"
     th:if="${jugadores != null and !#lists.isEmpty(jugadores)}">

    <!-- T√≠tulo centrado y contenido m√°s estrecho -->
    <div class="col-12 col-lg-10">
        <h2 class="players-section-title text-center">
            <i class="fas fa-shirt me-3"></i>Jugadores de la plantilla
        </h2>

        <!-- Para filtrar por posici√≥n -->
        <div class="players-filter text-center mt-4 mb-3">
            <button type="button"
                    class="filter-chip active"
                    data-posicion="Todos"
                    onclick="filtrarJugadores('Todos', this)">
                Todos
            </button>

            <button type="button"
                    class="filter-chip"
                    data-posicion="Portero"
                    onclick="filtrarJugadores('Portero', this)">
                Porteros
            </button>

            <button type="button"
                    class="filter-chip"
                    data-posicion="Defensa"
                    onclick="filtrarJugadores('Defensa', this)">
                Defensas
            </button>

            <button type="button"
                    class="filter-chip"
                    data-posicion="Centrocampista"
                    onclick="filtrarJugadores('Centrocampista', this)">
                Centrocampistas
            </button>

            <button type="button"
                    class="filter-chip"
                    data-posicion="Delantero"
                    onclick="filtrarJugadores('Delantero', this)">
                Delanteros
            </button>
        </div>

        <!-- Grid de jugadores centrado -->
        <div class="row g-4 justify-content-center" id="jugadoresGrid">
            <div class="col-12 col-sm-6 col-md-4 col-lg-3 jugador-item"
                 th:each="jugador : ${jugadores}"
                 th:attr="data-posicion=${jugador.posicion}">
                <div class="player-card h-100">
                    <img th:src="${jugador.imagenUrl}"
                         th:alt="${jugador.nombre}">
                    <div class="player-card-body">

                        <span class="player-badge"
                              th:classappend="' pos-' + ${#strings.toLowerCase(jugador.posicion)}"
                              th:text="${jugador.posicion}">
                            Centrocampista
                        </span>

                        <h5 th:text="${jugador.nombre}">Nombre jugador</h5>

                        <p class="player-meta">
                            <strong>Dorsal:</strong>
                            <span th:text="${jugador.dorsal}">10</span>
                        </p>
                        <p class="player-meta">
                            <strong>Edad:</strong>
                            <span th:text="${jugador.edad}">21</span> a√±os
                        </p>
                        <p class="player-meta">
                            <strong>Nacionalidad:</strong>
                            <span th:text="${jugador.nacionalidad}">Espa√±a</span>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Mensaje si no hay jugadores -->
<div class="row mt-5"
     th:if="${jugadores == null or #lists.isEmpty(jugadores)}">
    <div class="col-12">
        <div class="stat text-center">
            <p class="mb-0">No hay jugadores cargados todav√≠a en la base de datos.</p>
        </div>
    </div>
</div>

<footer>
    <div class="container">
        <p>
            <i class="fas fa-copyright"></i> 2025 Bar√ßa Athletic Hub.  Todos los derechos reservados.
        </p>
    </div>
</footer>

<!-- Bot√≥n flotante del chatbot -->
<button class="chatbot-float-btn" id="chatbotFloatBtn" onclick="toggleChatbot()">
    <i class="fas fa-robot"></i>
    <span class="chatbot-badge" id="chatbotBadge" style="display: none;">1</span>
</button>

<!-- Modal del chatbot -->
<div class="chatbot-modal" id="chatbotModal">
    <div class="chatbot-modal-header">
        <h3><i class="fas fa-robot me-2"></i>Asistente de Jugadores</h3>
        <button class="chatbot-close-btn" onclick="toggleChatbot()">
            <i class="fas fa-times"></i>
        </button>
    </div>

    <div class="chatbot-messages" id="chatbotMessages">
        <div class="chatbot-message bot">
            <div class="chatbot-bubble" id="initialMessage">
                ¬°Hola! üëã Soy tu asistente <strong>Bar√ßAI</strong>.<br><br>
                <strong>Esto es lo que me puedes pedir:</strong>
                <br><br>
                <strong>Cargando opciones...</strong>
            </div>
        </div>
    </div>

    <div class="chatbot-typing" id="chatbotTyping">
        <span></span>
        <span></span>
        <span></span>
    </div>

    <!-- Input de texto eliminado - Solo interacci√≥n por botones -->
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const chatbotSessionId = 'plantilla_' + Date.now();

    function toggleChatbot() {
        const modal = document.getElementById('chatbotModal');
        const badge = document.getElementById('chatbotBadge');
        modal.classList.toggle('active');

        if (modal.classList.contains('active')) {
            badge.style.display = 'none';
            console.log('Chatbot abierto');
        }
    }

    function scrollChatbotToBottom() {
        const messages = document.getElementById('chatbotMessages');
        messages.scrollTop = messages.scrollHeight;
    }


    function addChatbotMessage(text, sender, videoUrl = null) {
        const messagesDiv = document.getElementById('chatbotMessages');
        const messageDiv = document.createElement('div');
        messageDiv.className = `chatbot-message ${sender}`;

        const bubble = document.createElement('div');
        bubble.className = 'chatbot-bubble';

        // Convertir saltos de l√≠nea a <br> y preservar formato
        const formattedText = text.replace(/\n/g, '<br>');
        bubble.innerHTML = formattedText;

        // Si hay video, agregarlo
        if (videoUrl) {
            const videoContainer = document.createElement('div');
            videoContainer.className = 'chatbot-video-container';
            videoContainer.innerHTML = `
                <iframe
                    src="${videoUrl}"
                    frameborder="0"
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                    allowfullscreen
                    loading="lazy">
                </iframe>
            `;
            bubble.appendChild(videoContainer);

            // Agregar bot√≥n para abrir en YouTube
            const youtubeLink = document.createElement('div');
            youtubeLink.style.marginTop = '8px';
            youtubeLink.style.textAlign = 'center';
            youtubeLink.innerHTML = `
                <a href="${videoUrl.replace('/embed?listType=search&list=', '/results?search_query=')}"
                   target="_blank"
                   style="color: #004D98; text-decoration: none; font-size: 0.85rem; font-weight: 600;">
                    <i class="fab fa-youtube" style="color: #FF0000;"></i> Ver m√°s en YouTube ‚Üí
                </a>
            `;
            bubble.appendChild(youtubeLink);
        }

        messageDiv.appendChild(bubble);
        messagesDiv.appendChild(messageDiv);
        scrollChatbotToBottom();
    }

    // Variable global para almacenar jugadores
    let jugadoresData = [];
    let jugadoresPorPosicion = {};

    // Cargar lista de jugadores al iniciar
    window.addEventListener('load', async function() {
        try {
            const response = await fetch('/api/chat/plantilla/jugadores');
            if (response.ok) {
                jugadoresData = await response.json();

                // Agrupar por posici√≥n
                jugadoresData.forEach(j => {
                    if (!jugadoresPorPosicion[j.posicion]) {
                        jugadoresPorPosicion[j.posicion] = [];
                    }
                    jugadoresPorPosicion[j.posicion].push(j);
                });

                // Mostrar men√∫ principal
                mostrarMenuPrincipal();

                console.log('Chatbot de plantilla inicializado correctamente');
                console.log('Total jugadores cargados:', jugadoresData.length);
            }
        } catch (error) {
            console.error('Error cargando jugadores:', error);

            const initialMsg = document.getElementById('initialMessage');
            if (initialMsg) {
                initialMsg.innerHTML = '¬°Hola! üëã Soy tu asistente <strong>Bar√ßAI</strong>.<br><br>‚ö†Ô∏è Hubo un error al cargar los jugadores. Por favor, recarga la p√°gina.';
            }
        }
    });

    // Funci√≥n para agregar bot√≥n "Volver al men√∫"
    function agregarBotonVolver() {
        const messagesDiv = document.getElementById('chatbotMessages');
        const btnDiv = document.createElement('div');
        btnDiv.className = 'chatbot-message bot';
        btnDiv.style.marginTop = '10px';

        const bubble = document.createElement('div');
        bubble.className = 'chatbot-bubble';
        bubble.style.textAlign = 'center';
        bubble.style.padding = '5px';

        const backBtn = document.createElement('button');
        backBtn.className = 'chatbot-back-btn';
        backBtn.innerHTML = '<i class="fas fa-arrow-left"></i> Volver al men√∫ principal';
        backBtn.onclick = () => {
            // Limpiar TODOS los mensajes
            messagesDiv.innerHTML = '';

            // Recrear mensaje inicial
            const initialDiv = document.createElement('div');
            initialDiv.className = 'chatbot-message bot';

            const initialBubble = document.createElement('div');
            initialBubble.className = 'chatbot-bubble';
            initialBubble.id = 'initialMessage';

            initialDiv.appendChild(initialBubble);
            messagesDiv.appendChild(initialDiv);

            // Mostrar men√∫ principal nuevamente
            mostrarMenuPrincipal();
            scrollChatbotToBottom();
        };

        bubble.appendChild(backBtn);
        btnDiv.appendChild(bubble);
        messagesDiv.appendChild(btnDiv);
        scrollChatbotToBottom();
    }

    function mostrarMenuPrincipal() {
        const initialMsg = document.getElementById('initialMessage');

        let mensaje = '¬°Hola! üëã Soy tu asistente <strong>Bar√ßAI</strong>.<br><br>';
        mensaje += '<strong>Esto es lo que me puedes pedir:</strong>';

        // Crear botones de opciones
        const opcionesDiv = document.createElement('div');
        opcionesDiv.className = 'chatbot-options';

        const opciones = [
            { icon: 'fa-user', text: '1. Informaci√≥n de un jugador', action: 'info-jugador' },
            { icon: 'fa-users', text: '2. Jugadores por posici√≥n', action: 'por-posicion' },
            { icon: 'fa-chart-bar', text: '3. Informaci√≥n general de la plantilla', action: 'info-general' }
        ];

        opciones.forEach(opcion => {
            const btn = document.createElement('button');
            btn.className = 'chatbot-option-btn';
            btn.innerHTML = `<i class="fas ${opcion.icon}"></i> ${opcion.text}`;
            btn.onclick = () => seleccionarOpcion(opcion.action);
            opcionesDiv.appendChild(btn);
        });

        initialMsg.innerHTML = mensaje;
        initialMsg.appendChild(opcionesDiv);
    }

    function seleccionarOpcion(accion) {
        // Deshabilitar todos los botones del men√∫ actual
        const botones = document.querySelectorAll('.chatbot-option-btn');
        botones.forEach(btn => {
            btn.style.pointerEvents = 'none';
            btn.style.opacity = '0.6';
        });

        switch(accion) {
            case 'info-jugador':
                mostrarListaJugadores();
                break;
            case 'por-posicion':
                mostrarListaPosiciones();
                break;
            case 'info-general':
                mostrarInfoGeneral();
                break;
        }
    }

    function mostrarListaJugadores() {
        const messagesDiv = document.getElementById('chatbotMessages');
        const messageDiv = document.createElement('div');
        messageDiv.className = 'chatbot-message bot';

        const bubble = document.createElement('div');
        bubble.className = 'chatbot-bubble';

        let mensaje = '<strong>üìã Selecciona un jugador:</strong>';

        const opcionesDiv = document.createElement('div');
        opcionesDiv.className = 'chatbot-options';
        opcionesDiv.style.maxHeight = '300px';
        opcionesDiv.style.overflowY = 'auto';

        // Ordenar jugadores alfab√©ticamente
        const jugadoresOrdenados = [...jugadoresData].sort((a, b) => a.nombre.localeCompare(b.nombre));

        jugadoresOrdenados.forEach(jugador => {
            const btn = document.createElement('button');
            btn.className = 'chatbot-option-btn';
            btn.innerHTML = `<i class="fas fa-user"></i> ${jugador.nombre} (#${jugador.dorsal}) - ${jugador.posicion}`;
            btn.onclick = () => consultarJugador(jugador.nombre, btn);
            opcionesDiv.appendChild(btn);
        });

        bubble.innerHTML = mensaje;
        bubble.appendChild(opcionesDiv);
        messageDiv.appendChild(bubble);
        messagesDiv.appendChild(messageDiv);
        scrollChatbotToBottom();
    }

    function mostrarListaPosiciones() {
        const messagesDiv = document.getElementById('chatbotMessages');
        const messageDiv = document.createElement('div');
        messageDiv.className = 'chatbot-message bot';

        const bubble = document.createElement('div');
        bubble.className = 'chatbot-bubble';

        let mensaje = '<strong>‚öΩ Selecciona una posici√≥n:</strong>';

        const opcionesDiv = document.createElement('div');
        opcionesDiv.className = 'chatbot-options';

        const iconos = {
            'Portero': 'fa-shield-alt',
            'Defensa': 'fa-user-shield',
            'Centrocampista': 'fa-running',
            'Delantero': 'fa-futbol'
        };

        Object.keys(jugadoresPorPosicion).sort().forEach(posicion => {
            const btn = document.createElement('button');
            btn.className = 'chatbot-option-btn';
            const count = jugadoresPorPosicion[posicion].length;
            btn.innerHTML = `<i class="fas ${iconos[posicion] || 'fa-user'}"></i> ${posicion}s (${count})`;
            btn.onclick = () => mostrarJugadoresPorPosicion(posicion, btn);
            opcionesDiv.appendChild(btn);
        });

        bubble.innerHTML = mensaje;
        bubble.appendChild(opcionesDiv);
        messageDiv.appendChild(bubble);
        messagesDiv.appendChild(messageDiv);
        scrollChatbotToBottom();
    }

    function mostrarJugadoresPorPosicion(posicion, botonSeleccionado) {
        // Marcar bot√≥n como seleccionado
        botonSeleccionado.classList.add('selected');

        const jugadores = jugadoresPorPosicion[posicion];
        let mensaje = `<strong>${posicion}s de la plantilla:</strong><br><br>`;

        jugadores.forEach(j => {
            mensaje += `‚Ä¢ <strong>${j.nombre}</strong> (#${j.dorsal}) - ${j.edad} a√±os - ${j.nacionalidad}<br>`;
        });

        addChatbotMessage(mensaje, 'bot');

        // Agregar bot√≥n volver
        agregarBotonVolver();
    }

    function mostrarInfoGeneral() {
        const totalJugadores = jugadoresData.length;
        const edadMedia = (jugadoresData.reduce((sum, j) => sum + j.edad, 0) / totalJugadores).toFixed(1);

        let mensaje = '<strong>üìä Informaci√≥n General de la Plantilla:</strong><br><br>';
        mensaje += `üë• <strong>Total de jugadores:</strong> ${totalJugadores}<br>`;
        mensaje += `üìÖ <strong>Edad media:</strong> ${edadMedia} a√±os<br><br>`;
        mensaje += '<strong>Por posici√≥n:</strong><br>';

        Object.keys(jugadoresPorPosicion).sort().forEach(posicion => {
            const count = jugadoresPorPosicion[posicion].length;
            mensaje += `‚Ä¢ ${posicion}s: ${count}<br>`;
        });

        // Jugador m√°s joven y m√°s veterano
        const masJoven = jugadoresData.reduce((min, j) => j.edad < min.edad ? j : min);
        const masVeterano = jugadoresData.reduce((max, j) => j.edad > max.edad ? j : max);

        mensaje += `<br>üë∂ <strong>M√°s joven:</strong> ${masJoven.nombre} (${masJoven.edad} a√±os)<br>`;
        mensaje += `üéñÔ∏è <strong>M√°s veterano:</strong> ${masVeterano.nombre} (${masVeterano.edad} a√±os)`;

        addChatbotMessage(mensaje, 'bot');

        // Agregar bot√≥n volver
        agregarBotonVolver();
    }

    function consultarJugador(nombreJugador, botonSeleccionado) {
        // Marcar bot√≥n como seleccionado
        if (botonSeleccionado) {
            botonSeleccionado.classList.add('selected');
        }

        // Simular que el usuario escribi√≥ el mensaje
        addChatbotMessage(`Informaci√≥n de ${nombreJugador}`, 'user');

        // Enviar al servidor
        enviarConsultaJugador(nombreJugador);
    }

    async function enviarConsultaJugador(nombreJugador) {
        const typing = document.getElementById('chatbotTyping');
        typing.style.display = 'block';
        scrollChatbotToBottom();

        try {
            const response = await fetch('/api/chat/plantilla/send', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    sessionId: chatbotSessionId,
                    message: `Informaci√≥n de ${nombreJugador}`
                })
            });

            const data = await response.json();
            typing.style.display = 'none';

            if (response.ok) {
                addChatbotMessage(data.reply, 'bot', data.videoUrl);
                // Agregar bot√≥n volver despu√©s de la respuesta
                agregarBotonVolver();
            } else {
                addChatbotMessage('Lo siento, hubo un error. Int√©ntalo de nuevo.', 'bot');
                agregarBotonVolver();
            }
        } catch (error) {
            console.error('Error:', error);
            typing.style.display = 'none';
            addChatbotMessage('Error de conexi√≥n. Por favor, verifica tu conexi√≥n.', 'bot');
            agregarBotonVolver();
        }
    }

    // ========================================
    // FUNCI√ìN PARA FILTRAR JUGADORES SIN RECARGAR LA P√ÅGINA
    // ========================================
    function filtrarJugadores(posicion, botonClickeado) {
        // 1. Actualizar clases activas en los botones
        const todosLosBotones = document.querySelectorAll('.filter-chip');
        todosLosBotones.forEach(btn => btn.classList.remove('active'));
        botonClickeado.classList.add('active');

        // 2. Obtener todas las tarjetas de jugadores
        const jugadores = document.querySelectorAll('.jugador-item');

        // 3. Filtrar seg√∫n la posici√≥n seleccionada
        jugadores.forEach(jugador => {
            const posicionJugador = jugador.getAttribute('data-posicion');

            if (posicion === 'Todos' || posicionJugador === posicion) {
                // Mostrar jugador con animaci√≥n
                jugador.style.display = 'block';
                jugador.style.opacity = '0';
                jugador.style.transform = 'translateY(20px)';

                setTimeout(() => {
                    jugador.style.transition = 'all 0.3s ease';
                    jugador.style.opacity = '1';
                    jugador.style.transform = 'translateY(0)';
                }, 10);
            } else {
                // Ocultar jugador
                jugador.style.transition = 'all 0.2s ease';
                jugador.style.opacity = '0';
                jugador.style.transform = 'translateY(-10px)';

                setTimeout(() => {
                    jugador.style.display = 'none';
                }, 200);
            }
        });

        // 4. Actualizar URL sin recargar (opcional, para mantener el estado en el historial)
        const url = new URL(window.location);
        if (posicion === 'Todos') {
            url.searchParams.delete('posicion');
        } else {
            url.searchParams.set('posicion', posicion);
        }
        window.history.pushState({}, '', url);
    }

    // Al cargar la p√°gina, aplicar el filtro si hay un par√°metro en la URL
    window.addEventListener('DOMContentLoaded', function() {
        const urlParams = new URLSearchParams(window.location.search);
        const posicionParam = urlParams.get('posicion');

        if (posicionParam) {
            const boton = document.querySelector(`.filter-chip[data-posicion="${posicionParam}"]`);
            if (boton) {
                filtrarJugadores(posicionParam, boton);
            }
        }
    });
</script>
</body>
</html>
